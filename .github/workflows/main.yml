name: Upload Filemoon/YouTube/Facebook para Google Drive

on:
  workflow_dispatch:
    inputs:
      video_url:
        description: 'Link do vÃ­deo (Filemoon, YouTube, Facebook)'
        required: true
        type: string
      start_time:
        description: 'Tempo de inÃ­cio (ex: 00:00:05)'
        required: false
        type: string
      end_time:
        description: 'Tempo final (ex: 00:01:00)'
        required: false
        type: string
      destino:
        description: 'Onde salvar (drive ou local)'
        required: false
        default: 'drive'
        type: choice
        options:
          - drive
          - local

jobs:
  process_video:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ”„ Checkout do cÃ³digo
        uses: actions/checkout@v3

      - name: ğŸ’¾ Cache do Node.js
        uses: actions/cache@v3
        with:
          path: ~/.npm
          key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-node-

      - name: âš™ï¸ Instalar dependÃªncias (ffmpeg, yt-dlp, nodejs)
        run: |
          sudo apt update
          sudo apt install -y ffmpeg python3-pip
          pip install -U yt-dlp
          curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
          sudo apt install -y nodejs
          npm install puppeteer

      - name: ğŸš€ Executar script de upload
        run: |
          node filemoon-upload-to-gdrive.js \
            "${{ github.event.inputs.video_url }}" \
            "${{ github.event.inputs.start_time || '00:00:00' }}" \
            "${{ github.event.inputs.end_time || '00:00:00' }}" \
            "${{ github.event.inputs.destino || 'drive' }}"
